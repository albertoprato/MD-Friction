\documentclass[a4paper,11pt]{article}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{geometry}
\usepackage{hyperref}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{booktabs}
\usepackage{amsmath}
\usepackage{float}
\geometry{top=2.5cm,bottom=2.5cm,left=2.5cm,right=2.5cm}
\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}
\lstdefinestyle{mystyle}{
	backgroundcolor=\color{backcolour},   
	commentstyle=\color{codegreen},
	keywordstyle=\color{magenta},
	numberstyle=\tiny\color{codegray},
	stringstyle=\color{codepurple},
	basicstyle=\ttfamily\footnotesize,
	breakatwhitespace=false,         
	breaklines=true,                 
	captionpos=b,                    
	keepspaces=true,                 
	numbers=left,                    
	numbersep=5pt,                  
	showspaces=false,                
	showstringspaces=false,
	showtabs=false,                  
	tabsize=2
}

\lstset{style=mystyle}

\title{\Huge \textbf{User Guide}\\[20pt] \LARGE Classical Molecular Dynamics \& Friction Tensor Calculation  \vspace{7cm}}
\author{\Large Alberto Prato - University of Padua \\[10pt] \href{mailto:albertoprato@studenti.unipd.it}{albertoprato@studenti.unipd.it}}
\date{}

\begin{document}
	
	\maketitle
	\newpage
	\tableofcontents
	\newpage
	
	\section{Introduction}
	
	This Fortran program simulates the classical molecular dynamics of a solute consisting of four spheres immersed in a viscous solvent. The simulation uses Lennard-Jones potentials and integrates numerically the equations of motion using the Velocity Verlet algorithm.
	
	The goal is to compute the friction tensor of the solute as a function of time through the time-autocorrelation function of the forces experienced by the solute particles.
	
	\newpage
	
	\section{Usage}
	
	\subsection{Prerequisites}
	
	To compile and run this software, the following tools and libraries are required:
	\begin{itemize}
		\item GFortran: The GNU Fortran compiler.
		\item FFTW3: The "Fastest Fourier Transform in the West" library.
		\item Make: The GNU Make build tool.
	\end{itemize}
	
	\subsection{Compilation and Running}
	
	A \texttt{Makefile} is provided in the source directory. To compile and run the program:
	\begin{enumerate}
		\item Navigate to the directory containing the source code (\texttt{verlet-LJ/}).
		\item Run the command:
		\begin{verbatim}
		make
		\end{verbatim} 
		This will generate an executable named \texttt{simulation}.
		
		Ensure that the linker flags in the Makefile (\texttt{-lfftw3 -lm}) match your system's configuration.
		
		\item Once compiled, the simulation requires the input files (\texttt{input.txt} and \texttt{system.xyz}) to be present in the directory \texttt{input/}. Run the executable from the terminal:
		\begin{verbatim}
			./simulation
		\end{verbatim}
	\end{enumerate}
	
	\newpage
	
	
	\section{Code Structure and Features}
	
	The source code is modular, with distinct responsibilities assigned to separate Fortran modules.
	
	\subsection{Main Program}
	
	The driver of the molecular dynamics simulation is the \texttt{main.f90}. Its primary responsibility is the time-evolution of the system through Velocity Verlet integration scheme. Additionally it handles memory allocation, input reading and calls to other modules for initialization, minimization, and analysis.
	
	\subsection{Modules}
	
	\begin{description}
		\item[\texttt{force\_module.f90}] \hfill \\
		Responsible for the evaluation of the forces and the potential energy. It models inter-atomic interactions via the Lennard-Jones potential. The module implements Periodic Boundary Conditions (PBC) utilizing the Minimum Image Convention, and applies a cutoff to optimize the computational cost of the $O(N^2)$ pair-wise interactions.
		
		\item[\texttt{minimization\_module.f90}] \hfill \\
		Performs an initial geometric optimization of the solvent structure, utilizing the conjugate gradient method (Polak-Ribi√®re variant) to drive the system towards a local energy minimum. This procedure is critical for resolving high-energy overlaps in the initial configuration, thereby preventing numerical divergence.
		
		\item[\texttt{velocity\_init\_module.f90}] \hfill \\
		Initializes the solvent velocities from the Maxwell distribution corresponding to the target thermodynamic temperature. To ensure the reference frame remains inertial, the module explicitly removes any net center-of-mass drift resulting from the stochastic sampling.
		
		\item[\texttt{fft\_correlation\_module.f90}] \hfill \\
		A module acting as an interface to the FFTW3 library. It computes time-correlation functions though FFT, reducing the algorithmic complexity of correlation calculations from $O(N^2)$ to $O(N \log N)$.
		
		\item[\texttt{friction\_module.f90}] \hfill \\
		It computes the time-dependent memory kernel (friction tensor) via the autocorrelation function of the instantaneous random forces exerted by the solvent on the solute.
		
		\item[\texttt{kinds.f90}] \hfill \\
		Defines numerical precision parameters (single and double precision) used throughout the simulation for consistency.
	\end{description}
	
	\subsection{Dependencies}
	
	The program handles the compilation hierarchy:
	\begin{itemize}
		\item[--] all modules depend on \texttt{kinds}.
		\item[--] \texttt{minimization\_module} depends on \texttt{force\_module}.
		\item[--] \texttt{friction\_module} depends on \texttt{fft\_correlation\_module}.
		\item[--] \texttt{main} depends on all modules.
	\end{itemize}
	
	\newpage
	
	\section{Input Files Structure}
	
	\subsection{Simulation Parameters: \texttt{input.txt}}
	
	The program reads simulation parameters from \texttt{input.txt}. The file format is rigid: parameters must be provided in the exact order shown below.
	
	\begin{table}[H]
		\centering
		\begin{tabular}{@{}llp{8cm}@{}}
			\toprule
			\textbf{Line} & \textbf{Parameters} & \textbf{Description} \\ \midrule
			1 & \texttt{n}, \texttt{dt} & total number of steps and time step in picosecond \\[5pt]
			2 & \texttt{mass}, \texttt{epsilon\_ss}, \texttt{sigma\_ss} & solvent mass, solvent-solvent LJ parameters \\[5pt]
			3 & \texttt{epsilon\_int}, \texttt{sigma\_int} & solute-solvent LJ parameters \\[5pt]
			4 & \texttt{temp}, \texttt{k\_B} & temperature and Boltzmann constant \\[5pt]
			5 & \texttt{box\_L} & length of the cubic simulation box \\ \bottomrule
		\end{tabular}
		\caption{Structure of \texttt{input.txt}}
	\end{table}
	
	Example of a \texttt{input.txt} file:
	\begin{lstlisting}
	50000 0.001
	18.015 63.597 3.1507
	43.472 3.338
	298.15 0.831
	20.0 \end{lstlisting}
	where the units of measurement used are picoseconds, Daltons, Kelvin, and angstroms.
	
	\subsection{Initial Configuration: \texttt{system.xyz}}
	
	The initial configuration must be provided in standard XYZ format; in this example it is generated by the Packmol software. The program assumes a specific order of lines:
	\begin{enumerate}
		\item Header: total number of atoms $N$.
		\item Solute Block (indices $1 - 4$): the first four entries must correspond to the solute particles.
		\item Solvent Block (indices $5 - N$): the remaining entries correspond to the solvent particles.
	\end{enumerate}
	
	\newpage
	
	\section{Output Files}
	
	The simulation produces three output files:
	
	\begin{itemize}
		\item \textbf{\texttt{trajectory.xyz}}: contains the atomic coordinates of the system at regular intervals (every 100 steps). This file is compatible with visualization software such as VMD.
		
		\item \textbf{\texttt{equilibration\_stats.dat}}: records the system properties during the equilibration phase
		\begin{itemize}
			\item Column 1: time
			\item Column 2: potential energy
			\item Column 3: mean squared displacement
		\end{itemize}
		
		\item \textbf{\texttt{friction\_tensor.dat}}: contains the elements of the friction tensor, calculated as the time-autocorrelation of the forces acting on the solute.
		\begin{itemize}
			\item Column 1: time
			\item Columns 2-13: friction tensor diagonal components for each of the 4 solute particles.
		\end{itemize}
	\end{itemize}
	
	A supplementary jupyter notebook (\texttt{Plot\_Friction\_Tensor.ipynb}) is provided in the \texttt{python\_tool/} directory. It allows to visualize the output data and graphically inspect the decay of the friction memory kernel.
	
\end{document}